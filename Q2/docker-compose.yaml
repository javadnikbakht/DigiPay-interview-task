version: '3'

services:
  locust:
    build: .
    container_name: digipay_locust
    ports:
     - "8089:8089"
    command: --host http://google.com -f /digipay/locustfile.py

  locust-metrics-exporter:
      image: containersol/locust_exporter
      container_name: digipay_locust_metrics_exporter
      ports:
          - "9646:9646"
      environment:
          - LOCUST_EXPORTER_URI=http://locust:8089
      depends_on:
          - locust

  prometheus:
    image: prom/prometheus:latest
    container_name: digipay_prometheus
    ports:
        - 9090:9090
    command:
        - --config.file=/etc/prometheus/prometheus.yml
    volumes:
        - ./prometheus.yml:/etc/prometheus/prometheus.yml:ro